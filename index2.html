<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>fht-azi-vis</title>
  <style>
    svg {
      outline: 2px solid black;
    }
  </style>
</head>
<body>
  
  <script type="module">
    import { SVG } from './node_modules/@svgdotjs/svg.js/dist/svg.esm.js';
    let W = 800, H = 800;
    let draw = SVG().addTo('body').size(W, H);
    
    async function loadJSON(file) {
      let res = await fetch(file)
      return res.json();
    }
    
    function rad(deg) {
      return deg / 180 * Math.PI;
    }
    
    function polar2cartesian(angle_deg, radius) {
      if (radius == -Infinity) radius = 0;
      let angle = rad(angle_deg - 90);
      return {
        x: radius * Math.cos(angle),
        y: radius * Math.sin(angle),
      };
    }
    
    (async function main() {
      let data = await loadJSON('./data/countries_azidist.json');
      // data = data.slice(0, 3);
      // console.log(data);

      // draw.circle(10).center(W/2,H/2);
      let scale = 90;
      
      for (let d of data) {
        if (d.country == 'Österreich') d.distance_km = 0;
        console.log(d);
        let p = polar2cartesian( d.azimuth_deg, (Math.log10(d.distance_km)) * scale ) ;

        p.x += W/2;
        p.y += H/2;
        draw.line(W/2, H/2, p.x, p.y).stroke({width:0.1, color:'black'});
        
        // let diameter = Math.max( 1, (Math.log10(d.count)) * 10 );
        let diameter = Math.max( 1, d.count/10 );
        
        draw.circle(diameter).center(p.x, p.y); //.fill('red');
        // if (Math.random() < 0.1)
        let t = draw.text(d.country).move(p.x+3, p.y+1.5).attr({'font-family': 'system-ui', 'font-size':5, 'opacity':0.5, 'fill':'black'})
        
        if (d.country == 'Österreich') t.attr({'fill':'white'});
      }
      
      for (let i=scale; i<=400; i+=scale) {
        draw.circle().radius(i).center(W/2, H/2).stroke({width:0.3, color:'black'}).fill('none')
      }
      
    })();
    
    
    function saveString(str, ext = '.svg', mime = 'image/svg+xml') {
      let link = document.createElement('a');
      let timestamp = new Date().toISOString();
      link.download = timestamp + ext;
      link.href = URL.createObjectURL(new Blob([str], {type: mime}));
      link.style.display = 'none';     // Firefox
      document.body.appendChild(link); // Firefox
      link.click();
      document.body.removeChild(link); // Firefox
    }

    
    document.addEventListener('keydown', e => {
      if (e.key === 's') {
        saveString (draw.svg() );
      }
    });
    
  </script>
</body>
</html>
